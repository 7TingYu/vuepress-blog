---
title: js utils - d3 - 00
date: 2022-05-09
tags:
 - js utils
categories:
 - threejs
---


为何开始学 d3.js 也许是为了以后想往可视化发展。不止听过一位为我描述过 d3.js。所以开始学吧。


## 资料

- [github](https://github.com/d3/d3/wiki)
- [observablehq 示例](https://observablehq.com/)
- [d3 官网](https://d3js.org.cn/)
- [官网画廊](https://github.com/d3/d3/wiki/Gallery?_blank)
- [WIKI教程](https://iowiki.com/d3js/d3js_quick_guide.html)


## Selections

选择是D3.js的核心概念之一。 它基于CSS选择器。 

- select() - 通过匹配给定的CSS选择器，仅选择一个DOM元素。 如果给定的CSS选择器有多个元素，则仅选择第一个元素。
- selectAll() - 通过匹配给定的CSS选择器来选择所有DOM元素。 如果您熟悉使用jQuery选择元素，则D3.js选择器几乎相同。


### 添加DOM元素

- append（）方法将新元素作为当前选择中元素的最后一个子元素附加。 
  ```js
  d3.select(".myclass").append("span");
  ```

### 修改元素


- text（）方法用于设置所选/附加元素的内容。
  ```js
  d3.select("div.myclass").append("span").text("from D3.js");
  ```
- html（）方法用于设置所选/附加元素的html内容。
  ```js
  d3.select(".myclass").html("Hello World! <span>from D3.js</span>");
  ```
- attr（）方法用于添加或更新所选元素的属性。
  ```js
  d3.select(".myclass").attr("style", "color: red");
  ```
- style（）方法用于设置所选元素的样式属性。
  ```js
  d3.select(".myclass").style("color", "red");
  ```

### classed 修改 class 属性

- classed（）方法专门用于设置HTML元素的“class”属性。

- Add class - 要添加类，必须将分类方法的第二个参数设置为true。
  ```js
  d3.select(".myclass").classed("myanotherclass", true);
  ```
- Remove class - 要删除类，必须将分类方法的第二个参数设置为false。
  ```js
  d3.select(".myclass").classed("myanotherclass", false);
  ```
- Check class - 要检查是否存在类，只需省略第二个参数并传递要查询的类名。 如果存在则返回true，否则返回false。
  ```js
  d3.select(".myclass").classed("myanotherclass");
  ```

## Data Join

数据连接是D3.js中的另一个重要概念。 它与选择一起使用，使我们能够根据我们的数据集（一系列数值）操作HTML文档。默认情况下，D3.js在其方法中为数据集提供最高优先级，并且数据集中的每个项对应于HTML元素。  

听起来很迷糊，一起看看怎么做

### example

```html
<ul id = "list">
   <li><li>
   <li></li>
</ul> 
```

```js
d3.select("#list").selectAll("li").data([10, 20, 30, 25, 15]);
```

现在，文档中有五个虚拟元素。 前两个虚拟元素是文档中定义的两个li元素，如下所示。

```
li - 10
li - 20
```

对于前两个li ，我们可以使用所有选择器的元素修改方法，如attr(), style(), text()等

```js
d3.select("#list").selectAll("li")
   .data([10, 20, 30, 25, 15])
   .text(function(d) { return d; });
```

接下来的三个元素可以映射到任何元素，可以使用数据连接的enter（）和selector的append（）方法完成。


- enter（）方法提供对剩余数据的访问（未映射到现有元素）

```js
d3.select("#list").selectAll("li")
   .data([10, 20, 30, 25, 15])
   .text(function(d) { return "This is pre-existing element and the value is " + d; })
   .enter()
   .append("li")
   .text(function(d) 
      { return "This is dynamically created element and the value is " + d; });
```


数据连接提供了另一种称为exit() method用于处理从数据集中动态删除的数据项


```js
d3.selectAll("li")
   .data([10, 20, 30, 15])
   .exit()
   .remove()
```


看下完整的代码

```html
<!DOCTYPE html>
<html>
   <head>
      <script type = "text/javascript" src = "https://d3js.org/d3.v4.min.js"></script>
      <style>
         body { font-family: Arial; }
      </style>
   </head>
   <body>
      <ul id = "list">
         <li></li>
         <li></li>
      </ul>
      <input type = "button" name = "remove" value = "Remove fourth value" 
         onclick = "javascript:remove()" />
      <script>
         d3.select("#list").selectAll("li")
            .data([10, 20, 30, 25, 15])
            .text(function(d) 
               { return "This is pre-existing element and the value is " + d; })
            .enter()
            .append("li")
            .text(function(d) 
               { return "This is dynamically created element and the value is " + d; });

         function remove() {
            d3.selectAll("li")
            .data([10, 20, 30, 15])
            .exit()
            .remove()
         }
      </script>
   </body>
</html>
```

### 数据连接方法

- datum() - 用于为HTML文档中的单个元素设置值。 
- data() - 用于将数据集分配给HTML文档中的元素集合。
- enter() - 输出之前没有图形元素的数据项集。
- exit() - 输出不再存在数据的图形元素集。使用它通过删除数据集中的数据项来动态删除其中一个元素。

**datum()**

```js
d3.select("p")
    .datum(50)
    .text(function(d) { 
        return "Used existing paragraph element and the data " + d + " is assigned."; 
    });

d3.select("div")
    .datum(100)
    .append("p")
    .text(function(d) { 
        return "Created new paragraph element and the data " + d + " is assigned."; 
    });
```

**data()**

```js
d3.select("#list").selectAll("li")
   .data([10, 20, 30, 25, 15]);
```

**enter()**

```js
d3.select("#list").selectAll("li")
   .data([10, 20, 30, 25, 15])
   .text(function(d) { return "This is pre-existing element and the value is " + d; })
   .enter()
   .append("li")
   .text(function(d) { return "This is dynamically created element and the value is " + d; });
```

**exit()**

```js
function remove() {
   d3.selectAll("li")
      .data([10, 20, 30, 15])
      .exit()
      .remove()
}
```

## Introduction to SVG

- SVG是基于矢量的图像格式，它是基于文本的。
- SVG在结构上与HTML类似。
- SVG可以表示为Document object model 。
- 可以将SVG属性指定为属性。
- SVG应该具有相对于原点（0,0）的绝对位置。
- SVG可以包含在HTML文档中。


### SVG + D3.js

**line**

```html
<div id = "svgcontainer"></div>
```

```js
var width = 300;
var height = 300;
var svg = d3.select("#svgcontainer")
   .append("svg").attr("width", width).attr("height", height);
```

在svg元素中添加line元素

```js
svg.append("line")
   .attr("x1", 100)
   .attr("y1", 100)
   .attr("x2", 200) 
   .attr("y2", 200)
   .style("stroke", "rgb(255,0,0)")
   .style("stroke-width", 2);
```

**rect**

```html
<svg width = "300" height = "300">
   <rect x = "20" y = "20" width = "300" height = "300" fill = "green"></rect>
</svg>
```

```js
var width = 300;
var height = 300;

//Create SVG element
var svg = d3.select("#svgcontainer")
    .append("svg")
    .attr("width", width)
    .attr("height", height);

//Create and append rectangle element
svg.append("rect")
    .attr("x", 20)
    .attr("y", 20)
    .attr("width", 200)
    .attr("height", 100)
    .attr("fill", "green");
```

**circle**

```html
<svg width = "300" height = "300">
   <circle cx = "200" cy = "50" r = "20" fill = "green"/>
</svg>
```

```js
var width = 300;
var height = 300;
//Create SVG element
var svg = d3.select("#svgcontainer")
    .append("svg")
    .attr("width", width)
    .attr("height", height);

//Append circle 
svg.append("circle")
    .attr("cx", 200)
    .attr("cy", 50)
    .attr("r", 20)
    .attr("fill", "green");
```

**ellipse**


```html
<svg width = "300" height = "300">
   <ellipse cx = "200" cy = "50" rx = "100" ry = "50" fill = "green" />
</svg>
```

```js
var width = 300;
var height = 300;

var svg = d3.select("#svgcontainer")
    .append("svg")
    .attr("width", width)
    .attr("height", height);

svg.append("ellipse")
    .attr("cx", 200)
    .attr("cy", 50)
    .attr("rx", 100)
    .attr("ry", 50)
    .attr("fill", "green")
```

## SVG Transformation


### SVG转换简介

SVG引入了一个新属性， transform为支持转换。

- **Translate** - 它有两个选项， tx沿x轴平移， ty沿y轴平移。 例如 - 翻译（30 30）。
- **Rotate** - 它有三个选项， angle指旋转角度， cx和cy指的是x和y轴旋转的中心。 如果未指定cx和cy ，则默认为坐标系的当前原点。 例如 - 旋转（60）。
- **Scale** - 它有两个选项， sx沿x轴的比例因子， sy沿y轴的比例因子。 这里， sy是可选的，如果没有指定，则它取sx的值。 例如 - 比例（10）。
- **Skew (SkewX and SkewY)** - 只需一个选项; skew-angle指的是SkewX沿x轴的角度和SkewY沿y轴的角度。 例如 - skewx（20）。


```html
<html>
   <head>
      <script type = "text/javascript" src = "https://d3js.org/d3.v4.min.js"></script>
   </head>
   <body>
      <svg width = "300" height = "300">
         <rect x = "20" 
            y = "20"
            width = "60"
            height = "60"
            fill = "green"
            transform = "translate(60 60) rotate(45)">
         </rect>
      </svg>
   </body>
</html>
```

转换也可以应用于SVG组元素。

```html
<html>
   <head>
      <script type = "text/javascript" src = "https://d3js.org/d3.v4.min.js"></script>
   </head>
   <body>
      <svg width = "300" height = "300">
         <g transform = "translate(60,60) rotate(30)">
            <rect x = "20" 
               y = "20" 
               width = "60" 
               height = "30" 
               fill = "green">
            </rect>
            <circle cx = "0" 
               cy = "0" 
               r = "30" 
               fill = "red"/>
         </g>
      </svg>
   </body>
</html>
```







